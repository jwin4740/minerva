<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="css/chessboard-0.3.0.css">
    <!--<script src="https://www.gstatic.com/firebasejs/3.6.5/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>-->
    <title> Minerva </title>
</head>

<body>
    <div id="headercontainer">
        <h3> SET POSITION </h3>
        <input type="text" id="fenInput">
        <button id=setFen>Set Fen</button>
    </div>
    <div id="board" style="width: 400px"></div>
    <div id="board2" style="width: 400px"></div>
    <input type="button" id="startBtn" value="Start" />
    <input type="button" id="clearBtn" value="Clear" />
    <input type="button" id="resetBtn" value="Reset" />
    <br><br><br>
    <div id="headercontainer">
        <h3> SET POSITION </h3>
        <input type="text" id="fenInput">
        <button id=setFen>Set Fen</button>
    </div>
    <div id="boardAndLabelsContainer">
        <div id="rankLabelsContainer">
        </div>
        <div id="boardContainer">
        </div>
        <br>
        <div id="fileLabelsContainer">
        </div>
    </div>
    <!--<script src="assets/javascript/minervadefs.js">
    </script>
    <script src="assets/javascript/board.js">
    </script>
    <script src="assets/javascript/minervamain.js">
    </script>-->
    <!--<script src="assets/javascript/minervagui.js">
    </script>-->
    <script src="./js/chess.js">
    </script>
    <script src="./js/chessboard-0.3.0.js">
    </script>
    <script>
        // var board1 = ChessBoard('board1', 'start');
        // var board2 = ChessBoard('board2', {
        //     draggable: true,
        //     dropOffBoard: 'snapback',
        //     sparePieces: true,
        //     position: "start"
        // });



        var board;
        var game = new Chess();

        $('#resetBtn').on("click", function () {
            console.log("clicked");
            game.reset();
        })

        // do not pick up pieces if the game is over
        // only pick up pieces for White
        var onDragStart = function (source, piece, position, orientation) {
            if (game.in_checkmate() === true || game.in_draw() === true ||
                piece.search(/^b/) !== -1) {
                return false;
            }
        };

        var makeRandomMove = function () {
            var possibleMoves = game.moves();
            console.log(possibleMoves.length);
              console.log(possibleMoves);

            // game over
            if (possibleMoves.length === 0) return;

            var randomIndex = Math.floor(Math.random() * possibleMoves.length);
            game.move(possibleMoves[randomIndex]);
            board.position(game.fen());
        };

        var onDrop = function (source, target) {
            // see if the move is legal
            var move = game.move({
                from: source,
                to: target,
                promotion: 'n'
            });

            // illegal move
            if (move === null) return 'snapback';

            // make random legal move for black
            window.setTimeout(makeRandomMove, 250);
        };

        // update the board position after the piece snap
        // for castling, en passant, pawn promotion
        var onSnapEnd = function () {
            board.position(game.fen());
        };

        var cfg = {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
        };
        board = ChessBoard('board', cfg);
        $('#clearBtn').on('click', board.clear);
        $('#startBtn').on('click', board.start);
    </script>
</body>

</html>